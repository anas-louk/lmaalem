# Firestore Database Structure

This document describes the Firestore database structure based on the UML diagram.

## üìã Collections Overview

The database consists of 5 main collections:

1. **users** - Base user information
2. **categories** - Employee categories
3. **employees** - Employee profiles (references User and Categorie)
4. **clients** - Client profiles (references User)
5. **missions** - Mission records (references Employee and Client)

## üîó Relationships

- A **User** can be an **Employee** or a **Client** depending on the `type` field
- An **Employee** belongs to one **Categorie** (via `categorieId` reference)
- An **Employee** references a **User** (via `userId` reference)
- A **Client** references a **User** (via `userId` reference)
- A **Mission** is assigned to one **Employee** (via `employeeId` reference)
- A **Mission** is created by one **Client** (via `clientId` reference)
- A **Client** can have many **Missions**

## üìÅ Collection Details

### 1. Collection: `users`

Base user information. Users can be either Employees or Clients based on the `type` field.

**Document Structure:**
```json
{
  "id": "string (document ID)",
  "nomComplet": "string",
  "localisation": "string",
  "type": "string ('Employee' or 'Client')",
  "tel": "string",
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
```

**Example Document:**
```json
{
  "id": "user_001",
  "nomComplet": "Ahmed Benali",
  "localisation": "Casablanca, Maroc",
  "type": "Employee",
  "tel": "+212612345678",
  "createdAt": "2024-01-15T10:30:00Z",
  "updatedAt": "2024-01-15T10:30:00Z"
}
```

**Fields:**
- `id` (string): Document ID (auto-generated by Firestore)
- `nomComplet` (string): Full name of the user
- `localisation` (string): User's location
- `type` (string): User type - either "Employee" or "Client"
- `tel` (string): Phone number
- `createdAt` (timestamp): Creation timestamp
- `updatedAt` (timestamp): Last update timestamp

---

### 2. Collection: `categories`

Employee categories (e.g., "Plumber", "Electrician", "Carpenter").

**Document Structure:**
```json
{
  "id": "string (document ID)",
  "nom": "string",
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
```

**Example Document:**
```json
{
  "id": "cat_001",
  "nom": "Plombier",
  "createdAt": "2024-01-10T08:00:00Z",
  "updatedAt": "2024-01-10T08:00:00Z"
}
```

**Fields:**
- `id` (string): Document ID (auto-generated by Firestore)
- `nom` (string): Category name
- `createdAt` (timestamp): Creation timestamp
- `updatedAt` (timestamp): Last update timestamp

---

### 3. Collection: `employees`

Employee profiles with additional information beyond the base User data.

**Document Structure:**
```json
{
  "id": "string (document ID)",
  "nomComplet": "string",
  "localisation": "string",
  "type": "string ('Employee')",
  "tel": "string",
  "image": "string (URL, optional)",
  "categorieId": "DocumentReference (reference to categories/{categorieId})",
  "ville": "string",
  "disponibilite": "boolean",
  "competence": "string",
  "bio": "string (optional)",
  "gallery": "string (optional)",
  "userId": "DocumentReference (reference to users/{userId})",
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
```

**Example Document (with DocumentReference):**
```json
{
  "id": "emp_001",
  "nomComplet": "Ahmed Benali",
  "localisation": "Casablanca, Maroc",
  "type": "Employee",
  "tel": "+212612345678",
  "image": "https://example.com/images/ahmed.jpg",
  "categorieId": "categories/cat_001",
  "ville": "Casablanca",
  "disponibilite": true,
  "competence": "Installation et r√©paration de plomberie",
  "bio": "Plombier exp√©riment√© avec 10 ans d'exp√©rience",
  "gallery": "https://example.com/galleries/ahmed",
  "userId": "users/user_001",
  "createdAt": "2024-01-15T10:30:00Z",
  "updatedAt": "2024-01-20T14:15:00Z"
}
```

**Alternative: Using String IDs (simpler approach):**
```json
{
  "id": "emp_001",
  "nomComplet": "Ahmed Benali",
  "localisation": "Casablanca, Maroc",
  "type": "Employee",
  "tel": "+212612345678",
  "image": "https://example.com/images/ahmed.jpg",
  "categorieId": "cat_001",
  "ville": "Casablanca",
  "disponibilite": true,
  "competence": "Installation et r√©paration de plomberie",
  "bio": "Plombier exp√©riment√© avec 10 ans d'exp√©rience",
  "gallery": "https://example.com/galleries/ahmed",
  "userId": "user_001",
  "createdAt": "2024-01-15T10:30:00Z",
  "updatedAt": "2024-01-20T14:15:00Z"
}
```

**Fields:**
- `id` (string): Document ID (auto-generated by Firestore)
- `nomComplet` (string): Full name (inherited from User)
- `localisation` (string): Location (inherited from User)
- `type` (string): Always "Employee"
- `tel` (string): Phone number (inherited from User)
- `image` (string, optional): Profile image URL
- `categorieId` (DocumentReference or string): Reference to the Categorie document
- `ville` (string): City where the employee works
- `disponibilite` (boolean): Availability status
- `competence` (string): Skills/competencies description
- `bio` (string, optional): Biography
- `gallery` (string, optional): Gallery URL or identifier
- `userId` (DocumentReference or string): Reference to the User document
- `createdAt` (timestamp): Creation timestamp
- `updatedAt` (timestamp): Last update timestamp

---

### 4. Collection: `clients`

Client profiles. Clients reference a User document.

**Document Structure:**
```json
{
  "id": "string (document ID)",
  "nomComplet": "string",
  "localisation": "string",
  "type": "string ('Client')",
  "tel": "string",
  "userId": "DocumentReference (reference to users/{userId})",
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
```

**Example Document (with DocumentReference):**
```json
{
  "id": "cli_001",
  "nomComplet": "Fatima Alami",
  "localisation": "Rabat, Maroc",
  "type": "Client",
  "tel": "+212698765432",
  "userId": "users/user_002",
  "createdAt": "2024-01-16T09:00:00Z",
  "updatedAt": "2024-01-16T09:00:00Z"
}
```

**Alternative: Using String IDs:**
```json
{
  "id": "cli_001",
  "nomComplet": "Fatima Alami",
  "localisation": "Rabat, Maroc",
  "type": "Client",
  "tel": "+212698765432",
  "userId": "user_002",
  "createdAt": "2024-01-16T09:00:00Z",
  "updatedAt": "2024-01-16T09:00:00Z"
}
```

**Fields:**
- `id` (string): Document ID (auto-generated by Firestore)
- `nomComplet` (string): Full name (inherited from User)
- `localisation` (string): Location (inherited from User)
- `type` (string): Always "Client"
- `tel` (string): Phone number (inherited from User)
- `userId` (DocumentReference or string): Reference to the User document
- `createdAt` (timestamp): Creation timestamp
- `updatedAt` (timestamp): Last update timestamp

---

### 5. Collection: `missions`

Mission records linking Clients and Employees.

**Document Structure:**
```json
{
  "id": "string (document ID)",
  "prixMission": "number (float)",
  "dateStart": "timestamp",
  "dateEnd": "timestamp",
  "objMission": "string",
  "statutMission": "string ('Pending', 'In Progress', 'Completed', 'Cancelled')",
  "commentaire": "string (optional)",
  "rating": "number (float, optional)",
  "employeeId": "DocumentReference (reference to employees/{employeeId})",
  "clientId": "DocumentReference (reference to clients/{clientId})",
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
```

**Example Document (with DocumentReference):**
```json
{
  "id": "mis_001",
  "prixMission": 500.00,
  "dateStart": "2024-02-01T08:00:00Z",
  "dateEnd": "2024-02-01T17:00:00Z",
  "objMission": "R√©paration de fuite d'eau dans la salle de bain",
  "statutMission": "Pending",
  "commentaire": "Urgent - besoin d'intervention rapide",
  "rating": null,
  "employeeId": "employees/emp_001",
  "clientId": "clients/cli_001",
  "createdAt": "2024-01-25T10:00:00Z",
  "updatedAt": "2024-01-25T10:00:00Z"
}
```

**Alternative: Using String IDs:**
```json
{
  "id": "mis_001",
  "prixMission": 500.00,
  "dateStart": "2024-02-01T08:00:00Z",
  "dateEnd": "2024-02-01T17:00:00Z",
  "objMission": "R√©paration de fuite d'eau dans la salle de bain",
  "statutMission": "Pending",
  "commentaire": "Urgent - besoin d'intervention rapide",
  "rating": null,
  "employeeId": "emp_001",
  "clientId": "cli_001",
  "createdAt": "2024-01-25T10:00:00Z",
  "updatedAt": "2024-01-25T10:00:00Z"
}
```

**Fields:**
- `id` (string): Document ID (auto-generated by Firestore)
- `prixMission` (number): Mission price
- `dateStart` (timestamp): Mission start date and time
- `dateEnd` (timestamp): Mission end date and time
- `objMission` (string): Mission objective/description
- `statutMission` (string): Mission status - one of: "Pending", "In Progress", "Completed", "Cancelled"
- `commentaire` (string, optional): Additional comments
- `rating` (number, optional): Rating given by the client (typically 1-5)
- `employeeId` (DocumentReference or string): Reference to the Employee document
- `clientId` (DocumentReference or string): Reference to the Client document
- `createdAt` (timestamp): Creation timestamp
- `updatedAt` (timestamp): Last update timestamp

---

## üîÑ Relationship Diagram

```
User (base entity)
‚îú‚îÄ‚îÄ type: "Employee" ‚Üí Employee
‚îÇ   ‚îú‚îÄ‚îÄ userId ‚Üí User
‚îÇ   ‚îî‚îÄ‚îÄ categorieId ‚Üí Categorie
‚îÇ
‚îî‚îÄ‚îÄ type: "Client" ‚Üí Client
    ‚îî‚îÄ‚îÄ userId ‚Üí User

Categorie
‚îî‚îÄ‚îÄ (one-to-many) ‚Üí Employees

Mission
‚îú‚îÄ‚îÄ employeeId ‚Üí Employee
‚îî‚îÄ‚îÄ clientId ‚Üí Client
```

## üìù Best Practices

1. **Document IDs**: Use auto-generated string IDs from Firestore instead of integers
2. **References**: Use DocumentReference for relationships when you need Firestore's referential integrity, or use string IDs for simpler queries
3. **Timestamps**: Always include `createdAt` and `updatedAt` for audit trails
4. **Indexes**: Create composite indexes for queries that filter on multiple fields (e.g., `employees` by `categorieId` and `disponibilite`)
5. **Security Rules**: Implement proper Firestore security rules to protect data access

## üîç Query Examples

### Get all available employees in a category:
```dart
firestore
  .collection('employees')
  .where('categorieId', isEqualTo: 'cat_001')
  .where('disponibilite', isEqualTo: true)
  .get();
```

### Get all missions for a client:
```dart
firestore
  .collection('missions')
  .where('clientId', isEqualTo: 'cli_001')
  .get();
```

### Get all missions for an employee:
```dart
firestore
  .collection('missions')
  .where('employeeId', isEqualTo: 'emp_001')
  .get();
```

### Get employee with category information:
```dart
// First get employee
final employeeDoc = await firestore.collection('employees').doc('emp_001').get();
final employee = employeeDoc.data();

// Then get category
final categorieId = employee['categorieId'];
final categorieDoc = await firestore.collection('categories').doc(categorieId).get();
final categorie = categorieDoc.data();
```

